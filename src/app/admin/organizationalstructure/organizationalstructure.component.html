<div [@routerTransition]>
    <div class="content d-flex flex-column flex-column-fluid">
        <sub-header
            [title]="'Company' | localize"
            [description]="'Structure' | localize"
        >
            <div role="actions" class="col-md-12 form-group">
                <label for="SwitchDescription">{{ switchDescription }}</label>
                <span>
                    <p-inputSwitch
                        [ngModel]="isSwitchDescription"
                        #SwitchDescription
                        name="SwitchDescription"
                        (onChange)="toggleSwitchDescription()"
                        onLabel="Yes"
                        offLabel="No"
                    >
                    </p-inputSwitch>
                </span>
            </div>
        </sub-header>

        <div [class]="containerClass">
            <div class="card card-custom">
                <div class="card-body">
                    <tabset>
                        <tab heading="Company Structure">
                            <div class="form overflow-auto">
                                <div class="row">
                                    <div *ngIf="isSwitchDescription">
                                        <organizational-tree
                                            #oTree
                                            (ouSelected)="ouSelected($event)"
                                            (organstruct)="getDeactivatedCompanyStructure()"
                                        ></organizational-tree>
                                    </div>
                                    <div *ngIf="!isSwitchDescription">
                                        <app-organization-chart
                                            #oChart
                                            (ouSelected)="ouSelected($event)"
                                        >
                                        </app-organization-chart>
                                    </div>
                                </div>
                            </div>
                        </tab>
                        <tab heading="Disabled CompanyStructure">
                           <br>
                           <div class="col-md-12 mt-0 text-right">

                            <div class="btn-group" dropdown>
                                <button
                                    dropdownToggle
                                    type="button"
                                    class="btn btn-outline-success dropdown-toggle mr-1"
                                    data-toggle="dropdown"
                                    aria-haspopup="true"
                                    aria-expanded="false"
                                >
                                    <i class="far fa-file-excel"></i>
                                    {{ "ExcelOperations" | localize }}
                                </button>
                                <div
                                    class="dropdown-menu dropdown-menu-right dropdown-excel-operations"
                                    *dropdownMenu
                                >
                                    <a
                                        class="dropdown-item"
                                        id="ExportAccrualToExcelButton"
                                        (click)="exportToExcel()"
                                        href="javascript:;"
                                    >
                                        <i
                                            class="fa fa-download mr-2 mt-1"
                                            style="font-size: 1rem"
                                        ></i>
                                        {{ "ExportToExcel" | localize }}
                                    </a>
                                </div>
                            </div>
                        </div>
                           <br/>
                           <div class="row align-items-center">
                            <div
                            class="primeng-datatable-container"
                            [busyIf]="primengTableHelperdisableComp.isLoading"
                        >
                        <p-table
                        #dataTable
                        [value]="primengTableHelperdisableComp.records"
                        rows="{{
                            primengTableHelperdisableComp.defaultRecordsCountPerPage
                        }}"
                        [paginator]="true"
                        [rows]="10"
                        [rowsPerPageOptions]="[5, 10, 15, 20]"
                        [lazy]="false"
                        [rowHover]="true"
                        sortMode="multiple"
                        [scrollable]="true"
                        ScrollWidth="100%"
                        [responsive]="primengTableHelperdisableComp.isResponsive"
                        [resizableColumns]="
                        primengTableHelperdisableComp.resizableColumns
                        "
                        [globalFilterFields]="[
                            'customCode',
                            'displayName',
                            'headUser',
                            'deleterName',
                            'deletionTime'
                        ]"
                        id="excel-table"
                    >
                        <ng-template pTemplate="caption">
                            <div style="text-align: right">
                                <i
                                    class="pi pi-search"
                                    style="margin: 4px 4px 0 0"
                                ></i>
                                <input
                                    type="text"
                                    pInputText
                                    size="30"
                                    placeholder="Search Keyword"
                                    style="width: auto"
                                    (input)="
                                        dataTable.filterGlobal(
                                            $event.target.value,
                                            'contains'
                                        )
                                    "
                                />
                            </div>
                        </ng-template>

                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width: 100px">
                                    {{ "Actions" }}
                                </th>
                                <th
                                    style="width: 100px"
                                    pSortableColumn="displayName"
                                >
                                    {{ "Display Name" }}
                                    <p-sortIcon
                                        field="displayName"
                                    ></p-sortIcon>
                                </th>
                                <th
                                    style="width: 100px"
                                    pSortableColumn="customCode"
                                >
                                    {{
                                        "MIS Code"
                                    }}
                                    <p-sortIcon
                                        field="customCode"
                                    ></p-sortIcon>
                                </th>
                                <th
                                style="width: 100px"
                                pSortableColumn="headUser"
                            >
                                {{
                                    "MIS Owner"
                                }}
                                <p-sortIcon
                                    field="headUser"
                                ></p-sortIcon>
                            </th>
                            <th
                            style="width: 100px"
                            pSortableColumn="deleterName"
                        >
                            {{
                                "Modified by"
                            }}
                            <p-sortIcon
                                field="deleterName"
                            ></p-sortIcon>
                        </th>
                        <th
                        style="width: 100px"
                        pSortableColumn="deletionTime"
                    >
                        {{
                            "Deletion Date"
                        }}
                        <p-sortIcon
                            field="deletionTime"
                        ></p-sortIcon>
                    </th>


                            </tr>
                        </ng-template>
                        <ng-template
                            pTemplate="body"
                            let-record="$implicit"
                        >
                            <tr>
                                <td style="width: 100px">
                                    <div
                                        class="btn-group dropdown"
                                        dropdown
                                        container="body"
                                    >
                                        <button
                                            dropdownToggle
                                            class="dropdown-toggle btn btn-sm btn-primary"
                                        >
                                            <i class="fa fa-cog"></i
                                            ><span class="caret"></span>
                                            {{ "Actions" }}
                                        </button>
                                        <ul
                                            class="dropdown-menu"
                                            *dropdownMenu
                                        >
                                            <li *ngIf="'Pages.Administration.CompanyStructure.Delete'| permission ">
                                                <a
                                                    href="javascript:;"
                                                    (click)="
                                                    showup(record.id)
                                                    "
                                                    >{{
                                                        "Activate"
                                                    }}</a
                                                >
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                                <td style="width: 100px">
                                    <span
                                        class="ui-column-title"
                                    ></span>
                                    {{ record.displayName }}
                                </td>
                                <td style="width: 100px">
                                    <span
                                        class="ui-column-title"
                                    ></span>
                                    {{ record.customCode }}
                                </td>
                                <td style="width: 100px">
                                    <span
                                        class="ui-column-title"
                                    ></span>
                                    {{ record.headUser}}
                                </td>
                                <td style="width: 100px">
                                    <span
                                        class="ui-column-title"
                                    ></span>
                                    {{ record.deleterName}}
                                </td>
                                <td style="width: 100px">
                                    <span
                                        class="ui-column-title"
                                    ></span>
                                    {{ record.deletionTime| luxonFormat: "F"}}
                                </td>


                            </tr>
                        </ng-template>
                    </p-table>

                            </div>

                           </div>

                        </tab>
                        <tab heading="Expense MIS Restriction" *ngIf="'Pages.Administration.CompanyStructure.RestrictExpenseRequisition'| permission ">
                            <br />
                            <br />
                            <form
                                #companyForm="ngForm"
                                (ngSubmit)="save()"
                            >
                                <div class="row align-items-center mb-2">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label
                                                class="small mb-1"
                                                for="inputFirstName"
                                                >Select MIS Unit</label
                                            >
                                            <ng-select
                                                [(ngModel)]="companydetails.id"
                                                name="companydetails"
                                                (change)="getallunit()"
                                            >
                                                <ng-option
                                                    *ngFor="
                                                        let item of CompanyStructureDto
                                                    "
                                                    [value]="item.id"
                                                >
                                                    {{ item.displayName }} -
                                                    {{
                                                        item.customCode
                                                    }}</ng-option
                                                >
                                            </ng-select>
                                        </div>

                                    </div>
                                    <div class="col-md-6" *ngIf="'Pages.Administration.CompanyStructure.RestrictExpenseRequisition.CreateEdit'| permission ">
                                        <br>
                                        <div class="form-group">
                                            <button type="submit" [buttonBusy]="saving" [busyText]="l('SavingWithThreeDot')"  flex="15" class="btn btn-primary "
                                            [disabled]="companydetails==null"
                                            >
                                            {{ "Restrict Expense Requisition" }}
                                            </button>
                                        </div>

                                       <!--  <div class="col-md-5">
                                            <div class="form-group">
                                                <label class="small mb-1" for="Vendor">
                                                    MIS Unit
                                                </label>
                                                <ng-multiselect-dropdown
                                                    [placeholder]="'Select Roles'"
                                                    [(ngModel)]="structure"
                                                    [ngModelOptions]="{
                                                        standalone: true
                                                    }"
                                                    [settings]="dropdownSettings"
                                                    [data]="CompanyStructureDto"
                                                    (onSelect)="selectRoles($event)"
                                                    (onSelectAll)="onSelectAll($event)"
                                                >
                                                </ng-multiselect-dropdown>
                                            </div>
                                        </div> -->

                                    </div>
                                </div>

                            </form>
                            <div class="col-md-12 mt-0 text-right">

                                <div class="btn-group" dropdown>
                                    <button
                                        dropdownToggle
                                        type="button"
                                        class="btn btn-outline-success dropdown-toggle mr-1"
                                        data-toggle="dropdown"
                                        aria-haspopup="true"
                                        aria-expanded="false"
                                    >
                                        <i class="far fa-file-excel"></i>
                                        {{ "ExcelOperations" | localize }}
                                    </button>
                                    <div
                                        class="dropdown-menu dropdown-menu-right dropdown-excel-operations"
                                        *dropdownMenu
                                    >
                                        <a
                                            class="dropdown-item"
                                            id="ExportAccrualToExcelButton"
                                            (click)=" exportExpenseRestToExcel()"
                                            href="javascript:;"
                                        >
                                            <i
                                                class="fa fa-download mr-2 mt-1"
                                                style="font-size: 1rem"
                                            ></i>
                                            {{ "ExportToExcel" | localize }}
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <div class="row align-items-center">
                                <div
                                    class="primeng-datatable-container"
                                    [busyIf]="primengTableHelper.isLoading"
                                >
                                    <p-table
                                        #dataTable
                                        [value]="primengTableHelper.records"
                                        rows="{{
                                            primengTableHelper.defaultRecordsCountPerPage
                                        }}"
                                        [paginator]="true"
                                        [rows]="10"
                                        [rowsPerPageOptions]="[5, 10, 15, 20]"
                                        [lazy]="false"
                                        [rowHover]="true"
                                        sortMode="multiple"
                                        [scrollable]="true"
                                        ScrollWidth="100%"
                                        [responsive]="primengTableHelper.isResponsive"
                                        [resizableColumns]="
                                            primengTableHelper.resizableColumns
                                        "
                                        [globalFilterFields]="[
                                            'customCode'
                                        ]"
                                        id="expenseRest-excel-table"
                                    >
                                        <ng-template pTemplate="caption">
                                            <div style="text-align: right">
                                                <i
                                                    class="pi pi-search"
                                                    style="margin: 4px 4px 0 0"
                                                ></i>
                                                <input
                                                    type="text"
                                                    pInputText
                                                    size="30"
                                                    placeholder="Search Keyword"
                                                    style="width: auto"
                                                    (input)="
                                                        dataTable.filterGlobal(
                                                            $event.target.value,
                                                            'contains'
                                                        )
                                                    "
                                                />
                                            </div>
                                        </ng-template>

                                        <ng-template pTemplate="header">
                                            <tr>
                                                <th style="width: 100px">
                                                    {{ "Actions" }}
                                                </th>
                                                <th
                                                    style="width: 100px"
                                                    pSortableColumn="displayName"
                                                >
                                                    {{ "Display Name" }}
                                                    <p-sortIcon
                                                        field="displayName"
                                                    ></p-sortIcon>
                                                </th>
                                                <th
                                                    style="width: 100px"
                                                    pSortableColumn="customCode"
                                                >
                                                    {{
                                                        "MIS Code"
                                                    }}
                                                    <p-sortIcon
                                                        field="customCode"
                                                    ></p-sortIcon>
                                                </th>
                                                <th
                                                style="width: 100px"
                                                pSortableColumn="customCode"
                                            >
                                                {{
                                                    "Head"
                                                }}
                                                <p-sortIcon
                                                    field="customCode"
                                                ></p-sortIcon>
                                            </th>

                                            </tr>
                                        </ng-template>
                                        <ng-template
                                            pTemplate="body"
                                            let-record="$implicit"
                                        >
                                            <tr>
                                                <td style="width: 100px">
                                                    <div
                                                        class="btn-group dropdown"
                                                        dropdown
                                                        container="body"
                                                    >
                                                        <button
                                                            dropdownToggle
                                                            class="dropdown-toggle btn btn-sm btn-primary"
                                                        >
                                                            <i class="fa fa-cog"></i
                                                            ><span class="caret"></span>
                                                            {{ "Actions" }}
                                                        </button>
                                                        <ul
                                                            class="dropdown-menu"
                                                            *dropdownMenu
                                                        >
                                                            <li *ngIf="'Pages.Administration.CompanyStructure.RestrictExpenseRequisition.CreateEdit'| permission ">
                                                                <a
                                                                    href="javascript:;"
                                                                    (click)="
                                                                    disactive(record)
                                                                    "
                                                                    >{{
                                                                        "Activate Expense Requistion"
                                                                    }}</a
                                                                >
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </td>
                                                <td style="width: 100px">
                                                    <span
                                                        class="ui-column-title"
                                                    ></span>
                                                    {{ record.displayName }}
                                                </td>
                                                <td style="width: 100px">
                                                    <span
                                                        class="ui-column-title"
                                                    ></span>
                                                    {{ record.customCode }}
                                                </td>
                                                <td style="width: 100px">
                                                    <span
                                                        class="ui-column-title"
                                                    ></span>
                                                    {{ record.headUser}}
                                                </td>


                                            </tr>
                                        </ng-template>
                                    </p-table>


                                </div>
                            </div>
                        </tab>
                    </tabset>
                </div>
            </div>
        </div>
    </div>
</div>








<div
    bsModal
    #createOrEditModal="bs-modal"
    (onShown)="onShown()"
    class="modal fade"
    tabindex="-1"
    role="dialog"
    aria-labelledby="createOrEditModal"
    aria-hidden="true"
    [config]="{ backdrop: 'static', keyboard: !saving }"
>
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <!-- <span *ngIf="organizationUnit.id">{{"Edit" | localize}}: {{organizationUnit.displayName}}</span>
                    <span *ngIf="!organizationUnit.id">{{"NewOrganizationUnit" | localize}}</span> -->
                </h5>

                <button
                    type="button"
                    class="close"
                    (click)="close()"
                    [attr.aria-label]="l('Close')"
                    [disabled]="saving"
                >
                    <i aria-hidden="true" class="ki ki-close icon-2x"></i>
                </button>
            </div>

            <div class="modal-body">


                        <br />
                        <form
                            *ngIf="active"
                            #editForm="ngForm"
                            novalidate
                            (ngSubmit)="updateAndActivate()"
                        >
                            <div class="row">
                                <div class="form-group col-md-6">
                                    <label for="OrganizationUnitDisplayName"
                                        >{{ "Category" | localize }} *</label
                                    >
                                    <div class="form-group">
                                        <select
                                        id = "OrganizationUnitDisplayName"
                                        name="acct"
                                        required
                                        class="form-control rounded"
                                        #organizationUnitUnitTypeId="ngModel"
                                        [(ngModel)]="organizationUnit.unitTypeId"
                                        [disabled]="true"

                                        >
                                      <option

                                    [ngValue]="0"
                                >

                                    </option>
                                        <option
                                            *ngFor="let acc of category"
                                            [ngValue]="acc.categoryOrder"
                                        >
                                            {{ acc.categoryName  }}
                                        </option>
                                    </select>
                                    </div>

                                </div>

                                <div class="form-group col-md-6">
                                    <label for="OrganizationUnitHead"
                                        >{{ "MIS Owner" | localize }} *</label
                                    >

                                    <div class="form-group">
                                        <ng-select  name="headUser"
                                        id="OrganizationUnitHead"

                                        class="rounded"
                                        #organizationUnitHead="ngModel"
                                        (ngModelChange) = " changeInHead($event)"
                                        [(ngModel)]="
                                            organizationUnit.headUser
                                        "

                                        (change)="GetCustomCode(organizationUnit.headUser)"
                                        >
                                            <ng-option  *ngFor="let acc of users"
                                            [value]="acc.userName">
                                            {{ acc.name }}{{ " " }}
                                            {{ acc.lastName }}
                                            </ng-option>
                                        </ng-select>

                                    </div>

                                    <validation-messages
                                        [formCtrl]="organizationUnitHead"
                                    ></validation-messages>
                                </div>
                            </div>

                            <div class="row">
                                <div class="form-group col-md-6">
                                    <label for="OrganizationUnitDisplayName"
                                        >{{ "MIS Name" | localize }} *</label
                                    >
                                    <input
                                        id="OrganizationUnitDisplayName"
                                        #organizationUnitDisplayName="ngModel"
                                        class="form-control"
                                        type="text"
                                        name="displayName"
                                        [ngClass]="{
                                            edited: organizationUnit.displayName
                                        }"
                                        [(ngModel)]="
                                            organizationUnit.displayName
                                        "
                                        [disabled]="organizationUnit.unitTypeId==5"
                                        required
                                        appInputSanitzation
                                        maxlength="128"
                                        [disabled]="true"
                                    />
                                    <validation-messages
                                        [formCtrl]="organizationUnitDisplayName"
                                    ></validation-messages>
                                </div>
                                <div
                                    class="form-group col-md-6 form-md-line-input form-md-floating-label no-hint"
                                >
                                    <label for="OrganizationUnitCustomCode"
                                        >{{ "Code" | localize }} *</label
                                    >
                                    <input
                                        id="OrganizationUnitCustomCode"
                                        #organizationUnitCustomCode="ngModel"
                                        class="form-control"
                                        type="text"
                                        name="customCode"
                                        [ngClass]="{
                                            edited: organizationUnit.customCode
                                        }"
                                        [disabled]="disable"
                                        [placeholder]="placeholderMessage"
                                        [(ngModel)]="
                                            organizationUnit.customCode
                                        "
                                        required
                                        pattern="[a-zA-Z0-9 ]*"
                                        maxlength="10"
                                        [disabled]="true"
                                    />
                                    <validation-messages
                                        [formCtrl]="organizationUnitCustomCode"
                                    ></validation-messages>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="OrganizationUnitCustomCode"
                                            >{{
                                                "Minimum Amount" | localize
                                            }}
                                            *</label
                                        >

                                        <p-inputNumber
                                        min="0"
                                        max="9999999999999"
                                        [minFractionDigits]="2"
                                        [maxFractionDigits]="2"
                                        name="minimumAmount"
                                        [(ngModel)]="organizationUnit.minimumAmount"
                                        mode="decimal"
                                        (ngModelChange)="changeOnMinimumAmount($event)"
                                        required
                                        ngDefaultControl


                                    ></p-inputNumber>


                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="OrganizationUnitCustomCode"
                                            >{{
                                                "Maximum Amount" | localize
                                            }}
                                            *</label
                                        >


                                        <p-inputNumber
                                        min="0"
                                        max="9999999999999"
                                        [minFractionDigits]="2"
                                        [maxFractionDigits]="2"
                                        name="maximumAmount"
                                        [(ngModel)]="organizationUnit.maximumAmount"
                                        mode="decimal"
                                        (ngModelChange)="changeOnMaximumAmount($event)"
                                        ngDefaultControl
                                        required

                                    ></p-inputNumber>


                                    </div>
                                </div>
                            </div>
                            <div class="row">

                                <div class="form-group text-right col-md-12">
                                    <button
                                        type="submit"
                                        class="btn btn-primary"
                                        [disabled]="!editForm.form.valid"
                                        [buttonBusy]="saving"
                                        [busyText]="l('SavingWithThreeDot')"
                                    >
                                        <i class="fa fa-save"></i>
                                        <span>{{ activateButton | localize }}</span>
                                    </button>
                                </div>
                            </div>
                        </form>



            </div>

            <div class="modal-footer">
                <button
                    [disabled]="saving"
                    type="button"
                    class="btn btn-default"
                    (click)="close()"
                >
                    {{ "Cancel" | localize }}
                </button>
            </div>
        </div>
    </div>
</div>

